# e-Comet.io-Task

### *Задание состоит из двух частей:*

## **1. API-приложение в docker на FastAPI**

**GET /api/repos/top100** - Отображение топ 100 публичных репозиториев. Топ составляется по количеству звезд (stars). Плюсом будет реализация сортировки по полям в виде параметров запроса

**GET /api/repos/{owner}/{repo}/activity?since={date1}&until={date2}** - Информация об активности репозитория по коммитам за выбранный промежуток времени по дням. Параметры запроса since и until для выбора промежутка дат

## **2. Парсер на данных с GitHub**

Периодический парсинг данных в PostgreSQL. Схемы таблиц в PostgreSQL должны соответствовать схемам эндпойнтов приложения. Реализация должна быть на базе тривиальной клауд функции Яндекс.Облака. По возможности все действия, необходимые для создания клауд функции и триггера, должны совершаться простым скриптом для Yandex Cloud CLI.

## **3. Другие требования**

- решение должно быть выложено на GitHub
- запросы к БД должны быть написаны на чистом SQL без использования ORM
- содержать инструкцию по запуску
- python 3.10+, PEP8
- код должен быть безопасным, с обработчиками ошибок

## **Инструкция по запуску**

1. Склонировать проект себе локально
2. Заполнить файл `.env` по образцу (`.env-example`)
3. Из корневой директории проекта выполнить команду `make all`
4. Перейти по адресу `http://localhost:8000/docs`

### Развертывание и тестирование парсера на Yandex Cloud

1. В первую очередь надо установить и инициализировать интерфейс командной строки Yandex Cloud по инструкции [как тут](https://yandex.cloud/ru/docs/iam/operations/sa/create)
2. Затем необходимо подготовить БД, чтобы клауд-функция могла записывать в нее данные. В моем случае использовался инструмент `ngrok` для создания туннеля к локальной БД. Для этого нужно:
    - Зарегистрироваться в `ngrok.com`, установить его и создать токен авторизации командами 
    ```bash
    snap install ngrok
    ngrok config add-authtoken <token из личного кабинета ngrok.com>
    ```
    - Выполнить команду ниже и получить параметры подключения к БД: хост и порт подключения
    ```bash 
    ngrok tcp 5432
    ```
3. Внести полученные от ngrok в файл `deploy_parser_yc.sh` 
    ```
    DB_USER="пользователь БД, по умолчанию postgres"
    DB_PASSWORD="пароль"
    DB_HOST="X.tcp.eu.ngrok.io"
    DB_PORT="XXXX"
    DB_NAME="имя БД"
    ```
4. Дать права на выполнение файла и запустить скрипт:
    ```bash
    chmod +x sh_scripts/deploy_parser.sh
    sh_scripts/deploy_parser.sh
    ```


